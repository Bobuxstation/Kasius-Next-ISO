<!DOCTYPE html>
<html>

<head>
    <title>Terminal</title>

    <link rel="stylesheet" href="deps/xterm.css">
    <link rel="stylesheet" href="../assets/scroll.css" id="style">

    <script src="deps/xterm.js"></script>
    <script src="deps/xterm-fit.js"></script>

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        #terminal {
            width: 100vw;
            height: 100vh;
        }

        .terminal {
            height: 100vh;
        }

        .xterm-viewport {
            background-color: #1d1d1ddd !important;
            backdrop-filter: blur(10px);
        }
    </style>
</head>

<body>
    <div id="terminal"></div>
    <script>
        const { exec } = require('child_process');
        const { Terminal } = window;
        const term = new Terminal();
        const fitAddon = new window.FitAddon.FitAddon();
        term.loadAddon(fitAddon);

        term.open(document.getElementById('terminal'));
        fitAddon.fit();
        term.write('Kasius Next Terminal\r\n$ ');
        let command = '';

        window.addEventListener('resize', () => {
            fitAddon.fit();
        });

        term.onKey(e => {
            const ev = e.domEvent;
            const printable = !ev.altKey && !ev.ctrlKey && !ev.metaKey;

            if (ev.keyCode === 13) {
                term.write('\r\n');
                if (command.trim().length > 0) {
                    exec(command, (error, stdout, stderr) => {
                        if (stdout) term.write(stdout.replace(/\n/g, '\r\n'));
                        if (stderr) term.write(stderr.replace(/\n/g, '\r\n'));
                        term.write('$ ');
                    });
                } else {
                    term.write('$ ');
                }
                command = '';
            } else if (ev.keyCode === 8) {
                if (command.length > 0) {
                    term.write('\b \b');
                    command = command.slice(0, -1);
                }
            } else if (printable) {
                term.write(e.key);
                command += e.key;
            }
        });
    </script>
</body>

</html>