<!DOCTYPE html>
<html>

<head>
    <title>Terminal</title>

    <link rel="stylesheet" href="deps/xterm.css">
    <link rel="stylesheet" href="../assets/scroll.css" id="style">

    <script src="deps/xterm.js"></script>
    <script src="deps/xterm-fit.js"></script>

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        #terminal {
            width: 100vw;
            height: 100vh;
        }

        .terminal {
            height: 100vh;
        }

        .xterm-viewport {
            background-color: #1d1d1ddd !important;
            backdrop-filter: blur(10px);
        }
    </style>
</head>

<body>
    <div id="terminal"></div>
    
    <script>
        const term = new Terminal();
        const fitAddon = new window.FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        term.open(document.getElementById('terminal'));
        fitAddon.fit();

        term.onKey(e => {
            ptyProcess.write(e.key);
        });

        window.addEventListener('resize', () => {
            fitAddon.fit();
            ptyProcess.resize(term.cols, term.rows)
        });

        const shell = require('os').platform() === 'win32' ? 'powershell.exe' : 'bash';
        const shellargs = require('os').platform() === 'win32' ? [] : ['--noprofile', '--norc'];
        const ptyProcess = require("node-pty").spawn(shell, shellargs, {
            name: 'xterm-color',
            cols: 80,
            rows: 30,
            cwd: process.env.HOME,
            env: process.env
        });

        ptyProcess.onData((data) => {
            term.write(data);
        });
    </script>
</body>

</html>